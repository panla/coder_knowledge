# 集群

[toc]

<https://www.rabbitmq.com/clustering.html>

## 集群的形成

### 形成集群的方式

- 在配置文件中用声明方式列出集群节点
- 基于 DNS，用声明方式
- 手动使用 rabbitmqctl

### 节点名称

```text
前缀(通常是 rabbit) 和主机名 `rabbit@hostname`
节点的名称需要唯一

不同主机，rabbit@hostname-1 rabbit@hostname-2
相同主机，rabbit-1@hostname rabbit-2@hostname
```

## 集群中的节点

### 什么是复制

```text
RabbitMQ 代理操作的所有数据/状态都在所有节点之间复制。
一个例外是消息队列，默认情况下它们驻留在一个节点上，尽管它们对所有节点都是可见和可访问的。
跨集群中的节点复制队列，需使用支持的队列类型
```

## 命令

```bash
# 停止
rabbitmqctl stop_app

# 重置
rabbitmqctl reset

# 加入集群
rabbitmqctl join_cluster [--ram] rabbit@rabbit-1

# 启动
rabbitmqctl start_app

# 集群状态
rabbitmqctl cluster_status

# 重启集群节点

# 更该节点类型
rabbitmqctl change_cluster_node_type disc(ram)
```

加入集群中的哪个节点不影响，只要是其中一个在线的即可

## 磁盘和内存节点
