# 进程线程协程

[TOC]

## 区别

- 1
  - 进程是资源分配的最小单位
  - 线程是程序执行的最小单位
  - 协程是用户态轻量级线程，调度由用户控制。
    - 协程有自己的寄存器上下文和栈
    - 协程调度切换时，将寄存器上下文和栈保存到其他地方，切换回来时，恢复
    - 直接操作栈基本没有内核切换开销
    - 可以不加锁访问全局变量
    - 节约内存，节约分配线程和切换的开销
- 2
  - 一个程序至少一个进程，一个进程至少一个线程
  - 进程拥有独立的内存单元，多个线程共享内存
  - 进程有独立的地址空间，不影响其他进程
- 3 资源消耗
  - 进程切换时消耗大于线程
- 4 相比进程，线程的优点
  - 易于调度
  - 开销小
  - 提高并发性
  - IO密集型
- 5 相比进程，线程的缺点
  - 线程之间同步和加锁控制更麻烦
  - 线程崩溃影响稳定性
- 6 通信
  - 进程通信一般通过内核，公共区
  - 同一进程的线程属于同一地址空间，可直接通信
  - 线程间通信：多个线程共享地址和数据空间，一个线程的数据可以直接提供给其他线程访问，不需操作系统内核，

进程状态

- 创建，就绪，阻塞，运行，销毁

## 1 进程线程协程应用场景

- 需要发挥CPU多核的场景
- 进程用于计算密集型
- 线程可用于IO密集型
- 协程作为用户态线程用于IO密集型，异步

## 2 进程线程资源

### 2.1 进程资源

### 2.2 线程资源

线程独有的资源：线程上下文

- 线程ID
- 栈
- 栈指针
- PC 程序计数器
- 通用目的寄存器
- 条件码
- 错误返回码
- 线程优先级

线程共享资源

- 进程代码段
- 进程公有数据
- 文件描述符
- 信号处理器
- 进程当前目录
- 进程用户ID，进程组ID

## 3 线程从进程那里获得了什么

## 4 进程间通信

### 4.1 what

进程之间信息交换，传输

一个进程不能直接访问另一个进程地址空间，进程之间通信，必须要通过内核缓冲区

为什么要进程间通信

- 数据传输：一个进程需要将它的数据发给其他进程
- 资源共享：多个进程之间共享同样资源
- 通知事件：一个进程向其他进程发送消息，通知他们发生了某种事件
- 进程控制：一个进程去控制另一个进程执行

### 4.2 通信方式与机制

- 管道
  - 存放在内存中的特殊文件，内核在内存中开辟缓冲区
- 消息队列
  - 管道效率低，
  - 消息队列时存放在内存中的消息的链表
- 共享内存
  - 消息队列速度较慢，数据读写需要经过用户态和内核态之间拷贝
  - 共享内存，两个进程的逻辑地址映射到物理空间的同一区域，所指向的区域是共享内存
- 信号量
  - 速度快，容易冲突
  - 信号量解决共享内存的互斥访问
- 信号
  - 进程通信机制中唯一的异步通信机制
- socket

## 5 线程

### 5.1 线程安全

在拥有共享数据的多条线程并行执行的程序中，线程安全通过同步机制保护各线程正常执行

并发，原子性，可见性，有序性

- 原子性：
- 可见性：一个线程修改值后，其他线程能够立即知道
- 有序性：

### 5.2 线程同步

锁包括：互斥锁，条件变量，读写锁

### 5.3 多线程锁机制

- 互斥量
- 递归锁
- 读写锁
- 旋转锁
