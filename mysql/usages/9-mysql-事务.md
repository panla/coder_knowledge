# 事务

## 简介

将一组SQL放在一个批次中去执行，共同成功，共同失败
由一系列数据库操作组成的一个完整的逻辑过程

## ACID原则

一致性，隔离性，原子性，持久性

持久性：事务处理结束后，对数据的修改就是永久的，即便系统故障也不会丢失
原子性：一个事务中的所有操作，共同成功，失败。事务在执行过程中发生错误，会被恢复到事务开始前的状态
隔离性：数据库允许多个并发事务同时对其数据进行读写和修改的能力，隔离性可以防止多个事务并发执行时由于交叉执行而导致数据的不一致
一致性：在事务开始之前和事务结束以后，数据库的完整性没有被破坏

隔离级别：未提交、读提交、可重复读和串行化

## 隔离所导致的问题

脏读：一个事务读取了另一个事务尚未提交的数据
不可重复读：在一个事务内读取表中的某一行数据，多次读取的结果不同
虚读，幻读：一个事务内读取到了别的事物插入的数据

## 操作

```sql
--关闭自动提交
set autocommit = 0

-- 开启
start transaction

...

-- 提交
commit

-- 回滚
rellback

--事务结束

-- 自动提交
set autocommit = 1

-- 设置一个事务的保存点
savepoint xxx

-- 回滚到保存点
rollback to savepoint xxx

-- 撤销保存点
release savepoint xxx
```
