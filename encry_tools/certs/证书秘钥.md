# 证书，密钥

公钥加密，私钥解密。私钥签名，公钥验证

## 自签名证书

```shell
# 生成 根 私钥
openssl genrsa -aes256 -out ca.key 2048

# 请求证书
openssl req -new -sha256 -key ca.key -out ca.csr -config ca.cnf

# 自签名根证书
openssl x509 -req -days 3650 -sha256 -signkey ca.key -in ca.csr -out ca.cer

###

# 生成 服务端 私钥
openssl genrsa -aes256 -out server.key 2048

# 请求证书
openssl req -new -sha256 -key server.key -out server.csr -config server.cnf

# 自签名服务端证书
openssl x509 -days 3650 -req -sha256 -extfile server.v3.ext -CA ca.cer -CAkey ca.key -CAcreateserial -in server.csr -out server.cer

###

# 生成 客户端 私钥
openssl genrsa -aes256 -out client.key 2048

# 请求证书
openssl req -new -sha256 -key client.key -out client.csr -config client.cnf

# 自签名 客户端 证书
openssl x509 -days 3650 -req -sha256 -CA ca.cer -CAkey ca.key -CAcreateserial -in client.csr -out client.cer
```

```text
Organization Name
Organizational Unit Name
Common Name 根，服务端，客户端，要有区分
```

## 证书转换

### 去除秘钥密码

```shell
openssl rsa -in client.key -out client.key.unsecure
```

### .key 转 .pem

```shell
openssl rsa -in xxx.key -out xxx.pem
```

### .pem .cer 转 bks

```shell
# 生成 .p12
openssl pkcs12 -export -nodes -in client.cer -inkey client.key -out client.p12

# 生成 .bks
keytool -importkeystore -srckeystore client.p12 -srcstoretype pkcs12 -destkeystore client.bks -deststoretype bks -provider org.bouncycastle.jce.provider.BouncyCastleProvider -providerpath bcprov-ext-jdk15on-1.70.jar

# 查看证书列表
keytool -list -rfc -keystore client.bks -storetype BKS -provider org.bouncycastle.jce.provider.BouncyCastleProvider -storepass 'bks秘钥库密码' -providerpath bcprov-ext-jdk15on-1.70.jar
```

### .cer 转 .pfx

```bash
# 生成 pfx
openssl pkcs12 -export -in client.cer -inkey client.key -out client.pfx
```

## 校验

```shell
openssl verify -CAfile ca.cer server.cer client.cer
```

## 文件

- ca.cer 根证书
- client.bks 客户端 BKS 证书
- client.key 客户端 KEY 私钥
- client.key.unsecure 客户端无密码私钥
- client.cer 客户单证书
