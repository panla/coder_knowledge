# 语言陷阱

## 1 多值赋值，短变量声明和赋值

### 1.1 多值赋值

#### 1.1.1

```go
// 1
var x, y int

// 2
var x, y int = 1, 2

// 3
var x, y = 1, 2

// 4
var (
    x int
    y string
)
```

#### 1.1.2 多值赋值的两种格式

```go
// 1 右边是返回多值的表达式
// 1.1
x, y = f()

// 1.2
for k, v := range map {
}

// 1.3
v, ok := i.(xxx)

// 2左边操作数与右边的单一返回值的表达式个数一致
x, y, z = a, b, c
```

#### 1.1.3 多值赋值语义

```text
对左侧操作数中的表达式，索引值进行计算和确定，首先确定左侧的操作数的地址，
然后对右侧的赋值表达式进行计算，如果右侧的表达式计算引用左侧的变量，则创建临时变量进行值拷贝
```

```go
func main() {
    x := []int{1, 2, 3}
    i := 0

    x[i], i = 2, x[i]
    // tmp = x[0]，1
    // x[0] = 2
    // i = tmp，1

    // x [2, 2, 3]
    // i 1
}
```

### 1.2 短变量

```go
func main() {
    a := va

    x, y := xx, yy
}
```

- 1 使用 ":=" 操作符，变量的定义和初始化同时完成
- 2 左侧变量名后不需要类型名，编译器靠右侧值进行推导
- 3 支持多值短变量声明赋值
- 4 只能在函数和类型方法内部使用
- 5 多值声明和赋值时，至少有一个变量是新创建的局部变量，不能同时为预先声明过的

"=" 和 ":="

- 1 "=" 不会声明并创建新变量，而是由作用域由内到外搜索
- 2 ":=" 至少要创建一个局部变量并初始化
